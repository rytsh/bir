---
import "../styles/global.css";
import Sidebar from "../components/Sidebar.astro";
import ThemeToggle from "../components/ThemeToggle.svelte";

interface Props {
  title: string;
  currentPath?: string;
}

const { title, currentPath } = Astro.props;
const gaId = import.meta.env.PUBLIC_GA_ID;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="generator" content={Astro.generator} />
    <title>{title} | Tools</title>
    {gaId && (
      <>
        <script async src={`https://www.googletagmanager.com/gtag/js?id=${gaId}`}></script>
        <script is:inline define:vars={{ gaId }}>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', gaId);
        </script>
      </>
    )}
    <!-- Prevent flash of wrong theme -->
    <script is:inline>
      const theme = localStorage.getItem('theme');
      if (theme === 'dark' || (!theme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      }
    </script>
  </head>
  <body class="h-screen bg-(--color-bg) flex flex-col overflow-hidden">
    <!-- Mobile Header -->
    <header class="lg:hidden shrink-0 bg-(--color-sidebar) text-white flex items-center px-4 justify-between">
      <a href="/" class="text-base font-medium tracking-tight">Tools</a>
      <div class="flex items-center gap-1">
        <ThemeToggle client:load />
        <button 
          id="menu-toggle" 
          class="p-2 hover:bg-white/10 transition-colors"
          aria-label="Toggle menu"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path id="menu-icon" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </header>

    <!-- Overlay -->
    <div id="overlay" class="fixed inset-0 bg-black/50 z-40 lg:hidden hidden" aria-hidden="true"></div>

    <div class="flex flex-1 min-h-0">
      <!-- Sidebar -->
      <div id="sidebar" class="fixed lg:static inset-y-0 left-0 z-50 transform -translate-x-full lg:translate-x-0 transition-transform duration-200 ease-in-out h-full">
        <Sidebar currentPath={currentPath} />
      </div>

      <!-- Main Content -->
      <main class="flex-1 p-4 pt-2 w-full mx-auto overflow-auto">
        <slot />
      </main>
    </div>

    <script>
      const menuToggle = document.getElementById('menu-toggle');
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('overlay');

      const toggleMenu = () => {
        const isOpen = sidebar?.classList.contains('translate-x-0');
        
        if (isOpen) {
          sidebar?.classList.remove('translate-x-0');
          sidebar?.classList.add('-translate-x-full');
          overlay?.classList.add('hidden');
          document.body.style.overflow = '';
        } else {
          sidebar?.classList.remove('-translate-x-full');
          sidebar?.classList.add('translate-x-0');
          overlay?.classList.remove('hidden');
          document.body.style.overflow = 'hidden';
        }
      };

      menuToggle?.addEventListener('click', toggleMenu);
      overlay?.addEventListener('click', toggleMenu);

      window.addEventListener('resize', () => {
        if (window.innerWidth >= 1024) {
          sidebar?.classList.remove('translate-x-0');
          sidebar?.classList.add('-translate-x-full');
          overlay?.classList.add('hidden');
          document.body.style.overflow = '';
        }
      });
    </script>
  </body>
</html>
